install.packages("randomForest")
install.packages("ggplot2")
library(tidyverse)
library(broom)
## Set WD automatically to where the R scrip is
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
## Check the wd
getwd()
class(df.vil)
df.vil <- dplyr::tbl_df(readRDS("./data/village_data.rds"))
df.liv <- dplyr::tbl_df(readRDS("./data/livelihood_data.rds"))
class(df.liv)
df.vil$PK[!df.vil$PK %in% df.liv$FK] # villages not included
df.vil_red <- df.vil %>%
.[df.vil$PK %in% df.liv$FK, ] %>%  # villages included
select (.,PK,Longitude,Latitude)
df.vil_red <- df.vil_red %>% rename(Longitude.vil = Longitude, Latitude.vil = Latitude)
df.liv_mer <- merge(df.liv,df.vil_red, by.x = "FK", by.y = "PK")
library(raster)
df.liv_mer <- df.liv_mer %>%
mutate(dista = pointDistance(cbind(Longitude, Latitude), cbind(Longitude.vil, Latitude.vil), lonlat = TRUE))
df.liv_mer <- df.liv_mer %>%
group_by(., VIL_NAME) %>%
mutate(avg_dist = mean(dista)) %>%
ungroup()
df.liv_mer$FK == "akonetye"
view(df.liv_mer$FK == "akonetye")
View(df.liv_mer)
View(df.liv_mer)
rm(list = ls())
# Set WD automatically to where the R scrip is
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
df.liv = read.csv("./data/mfr_livelihood_post13_all2.csv", stringsAsFactors = F)
df.liv = read.csv("./data/mfr_livelihood_post13_all.csv", stringsAsFactors = F)
## LIVELIHOOD
df.liv <- tidyr::separate(data=df.liv,
col=wkt_geom,
into=c("delete", "Longitude","Latitude"),
sep=" ",
remove=FALSE)
df.liv$Latitude <- stringr::str_replace_all(df.liv$Latitude, "[)]", "")
df.liv$Longitude <- stringr::str_replace_all(df.liv$Longitude, "[()]", "")
df.liv$Latitude <- as.numeric(df.liv$Latitude)
df.liv$Longitude <- as.numeric(df.liv$Longitude)
#livelihood_data <-  subset(df.liv[c(1:1000),], select=-c(wkt_geom,delete)) ## in case you want to subset your dataset df[c(1:1000),]
livelihood_data <-  subset(df.liv, select=-c(wkt_geom,delete)) ## in case you want to subset your dataset df[c(1:1000),]
saveRDS(livelihood_data, "./data/livelihood_data.rds")
rm(livelihood_data) # keep the environment tidy
rm(list = ls())
library(tidyverse)
library(broom)
## Set WD automatically to where the R scrip is
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
## Check the wd
getwd()
df.vil <- dplyr::tbl_df(readRDS("./data/village_data.rds"))
class(df.vil)
df.liv <- dplyr::tbl_df(readRDS("./data/livelihood_data.rds"))
class(df.liv)
df.vil$PK[!df.vil$PK %in% df.liv$FK] # villages not included
df.vil_red <- df.vil %>%
.[df.vil$PK %in% df.liv$FK, ] %>%  # villages included
select (.,PK,Longitude,Latitude)
df.vil$PK[!df.vil$PK %in% df.liv$FK] # villages not included
df.vil_red <- df.vil %>%
.[df.vil$PK %in% df.liv$FK, ] %>%  # villages included
select (.,PK,Longitude,Latitude)
?select
df.vil_red <- df.vil %>%
.[df.vil$PK %in% df.liv$FK, ] %>%  # villages included
dplyr::select (.,PK,Longitude,Latitude)
df.vil_red <- df.vil_red %>% rename(Longitude.vil = Longitude, Latitude.vil = Latitude)
df.liv_mer <- merge(df.liv,df.vil_red, by.x = "FK", by.y = "PK")
library(raster)
df.liv_mer <- df.liv_mer %>%
mutate(dista = pointDistance(cbind(Longitude, Latitude), cbind(Longitude.vil, Latitude.vil), lonlat = TRUE))
df.liv_mer <- df.liv_mer %>%
group_by(., VIL_NAME) %>%
mutate(avg_dist = mean(dista)) %>%
ungroup()
saveRDS(df.liv_mer, "./data/liv_dist.rds")
View(df.liv_mer)
## Simple basemap fill and borders
base_map <- tm_shape(country_sub) +
tm_fill(alpha = 0.3) +
tm_borders(alpha = 0.6)
library(sf)
library(tmap)
countries <- sf::st_read("K:/tpd/AdminBoundaries/WFP_world_boundarieds/wld_bnd_adm0_wfpge_un.shp")
country_sub <- countries %>%
subset(., (adm0_name == "Cameroon" | adm0_name == "Democratic Republic of the Congo"))
## Simple basemap fill and borders
base_map <- tm_shape(country_sub) +
tm_fill(alpha = 0.3) +
tm_borders(alpha = 0.6)
liv_mer_sf <- st_as_sf(df.liv_mer,coords = c('Longitude', 'Latitude'), crs = 4326)
all_map <- base_map +
tm_shape(liv_mer_sf) +
tm_dots(col = "avg_dist", alpha = 0.5)
tmap_mode("view")
all_map
